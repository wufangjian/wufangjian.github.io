---
layout: post
title:  缓存 [http]
date:   2015-05-01 16:00:00 +0800
categories: [http]
---

> 缓存是前端性能优化中很重要的一个点，对缓存的理解也是衡量对http请求响应头是否理解。`强缓存`、`协商缓存`、`启发式缓存`

## http header中与缓存有关的key

![](/static/img/2017/15-05-01.png)

## 缓存协商策略用于重新验证缓存资源是否有效


![](/static/img/2017/15-05-02.png)

## Cache-Control

浏览器缓存里, Cache-Control是金字塔顶尖的规则, 它藐视一切其他设置, 只要其他设置与其抵触, 一律覆盖之

不仅如此, 它还是一个复合规则, 包含多种值, 横跨 存储策略, 过期策略 两种, 同时在请求头和响应头都可设置.

语法为: "Cache-Control : cache-directive".

Cache-directive共有如下12种(其中请求中指令7种, 响应中指令9种):

![](/static/img/2017/15-05-03.png)


假设所请求资源于5月5日缓存, 且在5月12日过期.

当max-age 与 max-stale 和 min-fresh 同时使用时, 它们的设置相互之间独立生效, 最为保守的缓存策略总是有效. 这意味着, 如果max-age=10 days, max-stale=2 days, min-fresh=3 days, 那么:

- 根据max-age的设置, 覆盖原缓存周期, 缓存资源将在5月15日失效(5+10=15);

- 根据max-stale的设置, 缓存过期后两天依然有效, 此时响应将返回110(Response is stale)状态码, 缓存资源将在5月14日失效(12+2=14);

- 根据min-fresh的设置, 至少要留有3天的新鲜期, 缓存资源将在5月9日失效(12-3=9);


由于客户端总是采用最保守的缓存策略, 因此, 5月9日后, 对于该资源的请求将重新向服务器发起验证.